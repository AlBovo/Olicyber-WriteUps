from pwn import xor
from itertools import cycle

# Given SBOX
SBOX = [
    23, 46, 93, 178, 209, 80, 169, 227, 246, 14, 79, 139, 196, 109, 176, 76,
    188, 74, 163, 187, 130, 110, 101, 241, 202, 239, 53, 117, 114, 72, 131, 217,
    71, 55, 253, 45, 212, 191, 59, 30, 104, 190, 251, 20, 94, 211, 84, 85, 68,
    73, 237, 205, 174, 97, 197, 199, 36, 180, 100, 215, 107, 62, 89, 81, 111, 119,
    32, 156, 214, 88, 183, 238, 18, 125, 231, 92, 127, 219, 138, 193, 141, 103,
    37, 236, 157, 41, 158, 135, 120, 9, 250, 172, 106, 136, 2, 123, 247, 248,
    26, 52, 54, 57, 204, 232, 7, 15, 140, 66, 245, 170, 144, 22, 203, 1, 56,
    167, 34, 244, 137, 19, 225, 143, 6, 184, 10, 60, 151, 165, 91, 40, 133, 70,
    128, 121, 220, 16, 152, 13, 58, 185, 254, 154, 198, 113, 160, 132, 206, 50,
    122, 116, 192, 179, 153, 47, 95, 200, 112, 145, 5, 126, 105, 243, 164, 181,
    146, 161, 129, 3, 48, 182, 189, 33, 148, 162, 69, 43, 234, 35, 39, 63, 150,
    142, 61, 90, 64, 78, 42, 83, 21, 155, 168, 229, 96, 173, 208, 207, 221, 82,
    242, 240, 27, 4, 186, 115, 17, 51, 159, 175, 75, 201, 44, 29, 218, 216, 108,
    8, 99, 28, 102, 118, 24, 230, 195, 86, 226, 166, 11, 0, 171, 65, 228, 38,
    223, 31, 67, 77, 49, 194, 124, 249, 222, 177, 252, 98, 235, 12, 210, 134, 233,
    87, 255, 147, 149, 213, 25
]

# Create inverse SBOX
inverse_SBOX = [0] * 256
for i in range(255):
    inverse_SBOX[SBOX[i]] = i

# Example ciphertext (replace with actual ciphertext from the challenge)
ciphertext = bytes.fromhex("38e5530c7b1ea4ba930d8180db1200358080a41c53ccdefedae8a8162afe6a245273628173e59f0d33721725539333131b3f853bd3feda3ff373fe4d16e85f737b29a4b75f1656b6445aa6c08c13bd5a5316334d163f9f3b40b6dabae0a48029d749e0b94cafec8de0937b9ba4e50d0d56fe28e85f004d811b3fe0166281c10b9f6033c4733f9edc4d81a4d6b10c569bec3fb10c3313ec5a370d40fed5e9a8739c811b94a8028cfe6a0b52c056721b3ff373a2af73249373e44d16e85f73f84d443fb16a331edab76c0d4cfeda3fe00dd39ba412916a331ed724520d4cb6441c530d33131bfca89e801ea4d19ec17b1eb75a3b0c8c1ea43fa8a440b6d5e93716334cecf553c18cfe6a2452738c81d7e9e00062294424a6c08c9ba424520dde80733f539e20fe380b9f2e7bfe1b29e00dd39ba4d69f0d56b617b7f973fd41db12539333afdb29a8737b8fbd5a0dcc95b649e900734d29ecb7f373fe4d7329e00d8180ecd19ea442e7a42bb1c16281a41c533bd3fe49e585167b1ea429b1a49c4dda43e0c04c291b5a520d409b17bae0f84d81492437168013a4ba5fff7b807343e00d80fe6a24a03b404d16e5e00280b6a41c53ccdefedaf59e1633131bf537cc20f6acaa53934080a42ba800564d495a2e22814dc1d65f163330dae8a816338df58d000d754d1b3fe0dc4c416a1291cc20fe69e952c18c13a4b7b1c14d1ec1129e738c29c124e03580b6445a5fc17bb817248573568049d6539320fe6e1a5f934d4c16e900738c8da42b533b339bec8d933b424d733ff973404ddbba53933375dae8a8933341c143e0167b29d71291c0e49ba4126c938013b75a7ccc4d8dda8d5f9333a3ec079ea4424d495a6bcc40b61612003bd3feda255f16331eec3fe0ccde80c15abdc18c29d51285603334e4e5000d814c17bae00d4caf445ab1027bafbd5a850dde72f525e00d56fe280b9f1656b6c10b9f73fdb6c1e59e6a334c1b0b9f0d4d9ba4e58573fd80161285603390c15a52226eafdb3fa8933372e4e59f0d56811b5a0d3b2afe1b5a9ec07b1e490b9173de4144ba5f73804cc125a8007b80445a531620fe6e2452c14d29c12400358080a40752cce48fec3fe00de4b6495a003b56fe1bb79e16339bf52585224cfe17e852ccde8df5256c0d4ce7a41291736e4c1b8d913b56fe1b2593c033411612a6c08c13b75a4bc0d372da8d913bd31eda5a5f734cb644e90073809ba4b75f93d341a41237164d81d5e90d734d4cda126b0de48fa4baa816334149248573fd80165a0dcc8081ecbaf37b3b55da2be0ff7341db24850c8cfe44e54f3b569becbae00d81b6c15a5f734d51daba85ccd3eda445853b8c13a40b9f007bfe6a24523b56e7a4d15f007b4cecbaa89333800b24857381b60be952cc3329f58df973b88017f5a8cc56fed51293168013a43f530cbfb64449e0b94c41daba9ea456fe280b9f168cfec125a89356b6e2e99e73e4b644e8e0934d8fa425a022e48d17baf3739880d55a003b56fe1bb79e16334ddb8d5f737b7244e90d60335517ba6c0de48fecba000d33800b248573d3afd5e5520dd3fe44240d6a3329da29e00d80b644b7b10233b628ba539e20fe84e9a893754dda5a9f3bd34d445aa8ffd34d4943e0f84cb673f5a8c18141a4244f0d56fe6ae59f3b801ea494a8168c80bd5a91ccbfb6f9e900734d4da4e8a82e4d81f549e05380b6441c530d334dc15a9e9356fe6a1285cc4dfe16249316801ea40752cce48fec3fe00062290be99e73809ba4129173e4b644e8f373eab66ae50dc0d3fe28259e167b4d495a93c04c1e17bae0ff621e17249f0d20fe6e1a5f934d4c16e900734d51daba85ccd3fe16e99316801ea4126c938013a4e5857340af49b7b10262eda4909ec18180733f9e93754dda5a5316338073120d73804cc125a8007b80445a520d62fe1be8a8358080c15a6b0d4c13da8d85c0defe73249373d380d55a0dcc8081ecbaf3735d9ba4e85f224c80da3fe0164d13280b9f734cb644e9006a3329da29e00c809bdbe90d73fd8016128573fdaf16e985ff8c9ba424536033c4733f9edc4d81a4949e9356b6f9e952c0dee7a40b913b62feecb76c0d4c8fec24857356b67329a8028029c15a0022814cec29a816808fec8df97381b6f9249f223380dbe585736eb6f92437028013a4e8a8dc804c1b43e0cc3372e4e59f0d56811b5a370d754dda5a912281afdb5a5f73b880161200603333178d9373fdb66a249f0c8cfe173fe0cce49bda5a5f00338df58d913bde80733f539e20fe6e255f0dd380733fe0334d29d5259e0c7b9ba4ba9e02338ff5e8b10c337216e5930d4c41c15a6c224c9b1b49e0d84d8fa43fa8a440b6d5e9371633b6733f9e0c424d495a9322de13f52bb16033c4733f9edc4d81a40b9f007bfe44240d6a3372db24853b8013a48d9e003329da1c530d3329f58df9739c811b94a8028cfe160bbd224c9becbae00d81b6c149e87bfe4d16e85f9e338fecf5373bd31eecb7f9738c4d0be99e73d380d55a000dde72da25e0ff6281c1e5f9736281d712e0166281c10b9f7340af73f5530d338fece50d6a3341d75aa8a45680db2b539e334117f5530d332917e852cc33b6d55a52224c804949e0b94d4c162437164d1ee2e99e737341f91285cce49ba4b7b10c6eb6a43f9f3bd39bec1c530d331eda8d9e00564d445a9e163329da3f53933380c15a0dcc818044e95f028cfe2fe50d0dd3fe1b29e0168081281200734d51daba85ccd3eda48152ccd31ea4e56c164d29c15a85cc40b6c112e093628dec0b003580fe1b2be0c17b9bf5255f7356afdb1c530de49ba4d69e0c338df58d532e7b41a48db19356811b43e0ff4d81a41237004d72c10b007373b6492437cc4daf4449e04381b6e2e95f9e338df58d913bde80733f539e338f1bd6a82e801ea43f530cbfb64443e00d56fed70b0d9e628ff55a0d3b331ef5e8523b40b6c1e9913be4fe6a245260336f17120073d3af16e8a8007b9b172ba8a433411612a6c04d9ba43f9f3bd39bec1c530d20fe7fe99fcc6eb6c1e99f7340af49b7b10262e7a424373bdefe1b5a2e0dd39bec0753c18013a407a82e4d29d5e90d6a3329ecba5273e480e2e99e735681ecba853b754dda5a913b8c13bd5a003b56fe1bb79e163375da250d0de49b17b7e0164d4c16e900734cb644e90073e480d75a9ec17b9bb75a8e16334d16e85f9e40afdbd69e0c3313ec5a5fc09c4dda43e0f87b29ec07539333a3ec079ea4424d495a6b0d81b6445a6cc18c8dda255f1633b817120060336f17120073754decbae0f84d4d0b125f1633131be99f3bd3edac5271c07b1ea43f9e9ebfafdb5a520d409b17bae03bbf1e17b7f973e4af735ab10ce441db24e0cc80511724e03be49bda2591c0defe1b49e049e49bdaf59e0c339bdb1200167bb81724e03be49bda2591c0defe16e593c0d3e7a4e58573804cc125a8007b80445a6b0d81b64449e0b94d4c162437164d1ee2e99e73fdb6c1e59e73b841d712523bd3b6445ab10c40b6bd5a9ec033131b3f853bd3fef525933b20febb3fa8ccdefec1240dff6281a4ba9e9ebf80db5a5f0c404da494a8168c80a429b19edeafd50bf373f9be1bba9ec1814d445aa00de48fdb249f3b56fe1be993166281a4249f22d3e7a4e585737b29c1249f028013a40b9f007beda4819fccd3fe173fe00db875ec29a8168081a42ba8ccdee7a494a8168c80a4e5523b754d1bb7e0224c8dec49e0b97341442452c1801ea4e5857381afdb240d73fdb6c1e59e736281d712e0bd4dbeec2953c18cfe17e852ccde8df5256c0d4cfedaf59e163330ec3f5f0d33131bf537cc20fe350b370d40fe73249373bfaf44e99e0c4dfeda8da89e20fe0fe900ff4d29d51200934dfe49e585167b1ea4d1a8a47ba317bae00de4b6495a53163372f52585167b9bf525f373134decbaa6c04dfec11237007b8f178d85734d4da4ba9e9e331eec3fe0ccde80c15a93c04c1e17baf3730929a4e593734d4cec3fe0cc40fed50b52224cfe17e8850c7b8dec24007340af73ba9e358041c149e87b0929a4e585739c811b94a8028cfe4912f373f981f5123773bf8016e89ea45680441c530d33751be9933b6e4d445a6c22d34dda259e6033e1c1125f9e3375db1237dc7b4c16e5f9734cb644e90073809ba4d19ec09cb61b3fe0167b29d71291c0e49bbd5a85224c9bf525e09e8c4ddb120073d3afd5e5520dd3fe1b8d850d2afeda3fe0164cb6443fa8358080a43fb10c56afdb5ab1027bafa424537381afdb240d603327daba853b6e4d16e90d73e4b64412e0a47ba3e443e0938c51ec3f853bd3fe173fe0cc81b6e2e95f9e3329da29f9734d4cda126b0de48fa4baa81633414924857342af160b9f6033ce1612a6c08c13a4249fcc56fe6a0b52c056721b3ff3739880d55a93c04c1e17bae0cce49bda5a53163380443fe00d8180ecd19ea442e7a4e5e09e8c4cdaba53cc4241a424373bdefe17e8850c7b8dec24006033e1c1125f9e3380175a52224c80495aa802334cec079e0c62fedbe9850c8013a4e5523b754dda3ff373038073245fa433131bfca89e801ea4b79e16801ea4e98573d380495a6b0c7b290b1252c18ce7a4245373deaf162400167b80a4b75fdce441a4e8b12e6281c112006033ce1612a6c08c13a4d19ec09cb61b3fe0f84d4d0b125f16333017e86cc05641c124f373fe4d16e85f9e3372f5ba530d4c80a4248573d34128129ea433800b248573fd80443fa82e804c17b7f373af41da299ea48c1ea4e5e0cce49bda5a9ec17b9bb752e8aa7b301bb7539333800b2400168c1ea4b75fdce441a4b75f93d341bd5a9e1633a3ec079ea4424d495a9e0c621ea4244f0dd39b1bbae00d56eda4cb533bd3fe441285738c13da3fe0f84d81492437168013a48da82e73eda4aa53934080a49453c1bf4dc1e5850d332917e852cc334cda0bf9737b29a429530cd34d445a2e0d81b6c15a53c181414929b10cbf80db5a853be48dec2b53a456eda4909fcc4d1eda8d857340af49b7b10262fe6fe9001662fe6a245273424dec5a2e22814dc1d65f1633a3ec079ea4424d4949e0b94d4c162437164d1ee2e99e73fd80165a4f0c8c30ec2b5f734d1ec143e00d80fe2f249f9e4d29c1e90d73e4b64412f373fe4d16e85f73d38049d69e0c3380db0b00738c8da4120dff4d81d5129e163330da1aa800804c1b49e0ef6281f912e0934d8fa4e952c18c13d70b9fff4d81a491539356afbd5a2e0d81fe281a5f0c4d9bdbe5e03580414949e87bafafdb07a87356afdb3fb10c33afdb29a86a3372f52585cc3329f58de0938c72ec2437737b8fbd5a850dde7217bae0bd804c28e985cc5680a48da82e73eda4cbb1a44d8da4baa8163341492485738c8dd7e90d938c29a4ba9e9e2afedaf59e163313f5e89e9356b6da5a5f0c404db75a4b0d42feecb76c0d4c8fec2485738141d7e900734cb644e9006a33b6d55a52cc40b673125f7381b60be952cc334c1b0b9f0d4d9ba4e593603355da2be0cc808dc10b9f73754d1bb7e00c809bdbe90d6a338df58d913bde80733f539e334c1b2953933341c143e00c809bdbe90d73e4b64412f373e84ddbe5bd3b564ddb5a913b409b17b7e03b42fe16249316801ea4e5e0c0819bdb12933b4d1eb75ad8224c80495aa8ffd34d495a912281afdb5a003b56fe1bb79e162afed70b37934d8dc12485c04cfe1b2ba8ff7b1ed71237dc33801612856033621be99f3bd3fec1240dff6281bd5a0dccd31e1b5a3722e4fe49e5463bde4d445a5fc17bb81724856a3330dae8a816334cf5259e9e33b649d69e0c42b6da3fe00d95e7a4ba9e023381173f9fc0defe44e56c3b4d29a4e89e223341d75a5f0c404db75ad00de4801b8de0ff6281c1e5f9734d811b3fe0cc56fed70b37027b13da8d85c0defed7e99f93801ebd5a00ccbfb6da8de0a47b1eec5a0dcc569becbae0a44db81724f9734d51da3fe0c0819bdb12933b4d1ea4ba9e9e33b817e50d734d4da42ba8ccdeeda46a9ea44d41735a9edc4d9ba4d653c1fdb673e59f738180f543e0bd7b9b1b24e0934d1328249f734d81f5baf3730929a4248573808173e5e00d80fe1be94fc04dfe281a5f0c4d9bdbe5e0bd7b30da259fcc3330ec3f5f0d331eec3fe0ccde80c15a9ec17b9bb752e8b94d4c162437164d1ee2e99e73b8411729a82e801ea48d53c18141a4baa816334149248573d380495a53c181414929b10cbf80db5a9ec14d13da8d85c0deeda4f19e02331eda2be0a47b1e165a53163380db0b0073bfbe1b259e164c41a4d6b1938080db24e00d9c80c15a000d42fe16124fc08141b75a8e16331e17ba933bbfb6c15a9ec14db62f24370233beda8d910c4d81ec3ff373a24decbae093624c1612933b564dd51237738c4cec1c53ccdefec10b9f166281bd5a5f16331e17ba933bbfb6c15a5f0c404da4f59fccfdb6d5e5e00d9c80c149e0b94c41daba9ea456fed70b37bd8c4c16120073b8411729a82e801ea43f530cbfb64443e0934d8fa429b19edeafd50be0cce49bda5a2e0de48073e5853bd3fe49e5520dd34d1b2b5f6033621b24930de441445a6b3be4b6f9e90073f84d443fb173fd80165abd3b6e80732b539e334c1b29a8a47b41b75a71c07b1ea4e585736eb6f92437028013a4b79e16801ebd5a3722e4fe2f249f9e4d29c1e90d73424dec49e0434d29dae53773bfaf44e99e0c4dfe492485c0d3fe1b3fe00d95fe17e852ccde8df5256c0d4ce7a4949ec133800b2400168c1ea424001633b6733f9e0c424d4949e049e4fe28e85f004d811b3fe09e8c5173e5e0bd7b9b1b24e0dc4c416a1291cc339bdab76cc0d3eda4cbb1a44d8da40752cce48fec3ff973d34128129ea43341d75a6b0d8051ece5857356b67329a8028029c143e09e8c4ddb12007356afdb3fb10c3313f5e89e9356b6da5a5f0c404dbd5a2e3b5641da5a853be48dec2b53a456fe16e593c0d3fef525933b33800b2485738141d7e90060333317e852cc33800b248573bfafdb3f853b56afdb5a2e0d81b6c143e0a44d8da424520dde80733f539e3329ecba526033621be99f3bd3fedaf59e935641445a0dcc8081ecbae0bd7b9b1b24e0c0819bdb12930dd3fe16e5933be4b61b49e049e49bdaf59e0c3380175a0d0d564d445a2e0d81fe1b2593c0337216e5930d4c41c15a6cc08130ec8d5f0c20fe35e9a8933330daba853b6e4d16e90d73804c16e50d00628128249f73de4144ba5f73e480d75a9edc4d1ec1e500603bf69424370d8c29a429b1a4fd4116e8a893339b17256c3bd3fe1b3fe00d81b6c15a52226eafdb3fa893338df58d2ecc814cecbaf3739880d55a00cc9cb6c13fa8933380c15a0dccd31e1b5a370d40fe16e5b10c4d80c149e0ef8c4ddb120073628173e59f0d334c1b295393331edab7f973e4af735a0d228180443fa80d3341733f9e738141d712373b8cfe730b376033621be99f3bd3fed70b0d9e628ff55a91c07bfe6a2452738c4d0be99e734d4decba0d2242e7a41291736e4c1b8d913b56fe4912e0f88c8dece8a8937b1eb75adaa433a316e537027b9ba48da82e73fe49e585167b1ebd5a6b0d4c13da8d85c0defe6a24523b56fe6a1285cc4de7a40752cce48fec3fe0c14d8dc1e900603334e4e5000d814c17bae0a46229a40752cce48fec3fe0166281c10b9f60333317e852ccdefe1b3fe0a48029d75a9ec03313ec5a9322e41eda1c53cc56fe6ae952ff809b1b3f9e738cfeec8de0938c72ec2437603bf69424370d8c29a43f9e9ebfafdb5a5fa45680a41c533bd3fe492485c0d3feec8d850d4c8f17b7f9737b8fa4ba539340b628128573fd8016128573de41162400c08c8f1b49e05380b6441c530d3329f58de09e7bfe731200c120fe350b370d40fe6ae952ff809b1b3f9e73de4144ba5f736eb6f92437028013bd5a0dcc818044e95f028cfe4912e00d9c80c143e0bd4dbeec2953c18cfe1b8d850d20fe6e2452c14d29c12400358080a43fa8a440b6d5e9371633131be99f3bd3fe441285738c13da3fe00d4c41c15a913b9c29ecba003bdefe1be8a83580414949e0a84c41445a850dde72f525f9738c29c124e0937b9ba4e50d0d56fe6a122e0d4c811b5a5fc0409bf525f9737b7244e90d7381afdb240d738141d712373b8cfe73e952c18ce7a4baa8163341492485737b1328249f027b80c15a0dcc9c291b5a913b8c13a4e5857381b6f9249f2220fe6e1a5f934d4c16e90073d3af16e8a8007b9b172ba8a43330dae8e002624cf525e00d56fed70b37bd8c4c161200603355da2be0166281c10b9f738c81d7e9f97340af73ba9e005680c1e99f73809ba425a022e48d17bae00d80e7a424533bd313f52be0cc338016128560336ff58d9e003341d75a9e0c8c9ba43fb10c56afdb49e0e280b6445a53c181414929b10cbf80db43e03bbf1e17b7e0bd7b9b1b24e0c0814c1bb793224c72da25e093801ed7126c3b56e7a42ba8ccdefe73e93700338fec2985c0defedafcf9734d9ba4f59fccfdb6d5e5e0cc80511724e0a47ba3e45a5f16334cda0bf373ea80443fa82e804c17b7e0cce49bda5aa8ffd34d495a6c0c7b13ecbae03be4fe2fe553007ba317bae0224c8dec5a52c0409b17bae00d56fe17e8850c7b8ddabae0ff621e17249f0d338d1707a8c17b41a429530c8c80345aff167b41495a53163375db1237dc7b4c16e5e0c17ba3da25b16a338df58d4fc04dfed5124fa47b1e44120d7381b6f9249f2220fe38e5530c7b1ea4244f0d56fe44e56c3b4d29a41237738c29c124e0164d13280b9f73bf8016e89ea45680441c530d331eda2be0cc56fe49e54fa48ceda46a9ea44d41735a9322de13f52bb16a338f1712e0937b9ba4e50d0d56fe2f25a8a49cb616e85f73fd80e41293c08141bd5a85c04c72ecbae0164d4c16e90073d3afd5e5520dd3fe6fe9001662e7a41c533bd3fe280b9f1656b6c10b9f7356afdb3fb10c3380443fe03580b6445a523b9c4d16e5f373f98016e89ea45680441c530d3329f58de0f84d4d0b125f16332917e852cc2afe6a1285cc4dfe0b255fbd7b8f1b5a373bd34cb752e8be8c13a4d69ec18180733f9e93754dda5a2e0dd39bec0753c18013a48d53c18141a4129173804cc125a8004d1eb75a2a0c8c80442437163313f5e8523bd3fe73e93700331e1bd6a80de4e7a4e9857381aff90b9f167b1ea40b9f007bfef912bd0de48f17b7e03be4eda4cb533bd3fe6a2452734d4cdab79ea4564d495a85c04c72ecbaf373a2af732493738141f5259e0d56feda8da89e3341d75a0d3b33411612a6c04d9ba4120dff4d81d5129e1620fe0f2491738c29c124e0a47b1eec43e00062294424a6c08c9ba424857342412812bdc0d3fe28e85f004d811b3ff9737b29c1249f028013a4e585738141d7e90060333317e852ccdefe173fe0006229d5120d0de49b17b7e09e8c5173e5f33eb8812e1c53f9e48d6c665fa4da4c6c7c28550f75240edcf89917242b93ccb9")  # Replace with the actual ciphertext

def find_key(ciphertext, key_length):
    key = [0] * key_length
    for i in range(key_length):
        group = ciphertext[i::key_length]
        best_byte = 0
        max_score = 0
        for possible_byte in range(256):
            score = 0
            for c in group:
                decrypted = c ^ possible_byte
                original = inverse_SBOX[decrypted]
                if 0x20 <= original <= 0x7E or original == 0x0A:
                    score += 1
            if score > max_score:
                max_score = score
                best_byte = possible_byte
        key[i] = best_byte
    return bytes(key)

def main():
    for key_length in range(6, 13):
        key = find_key(ciphertext, key_length)
        decrypted = xor(ciphertext, key)
        plaintext = bytes([inverse_SBOX[b] for b in decrypted])
        if b'|' in plaintext:
            parts = plaintext.split(b'|', 1)
            if len(parts) > 1:
                possible_flag = parts[1]
                if all(0x20 <= c <= 0x7E for c in possible_flag):
                    print(f"Key length: {key_length}")
                    print(f"Key: {key.hex()}")
                    print(f"Flag: {possible_flag.decode('utf-8')}")
                    return

if __name__ == "__main__":
    main()